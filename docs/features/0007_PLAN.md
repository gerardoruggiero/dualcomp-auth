# Plan Técnico - Edición de Companies

## Descripción
Implementar la funcionalidad completa de edición de companies, incluyendo:
1. Pantalla de edición que reutilice la estructura de `company-register.component.html`
2. Listado de companies con botón Edit en cada fila
3. Navegación desde el sidebar hacia el listado de companies
4. Componente genérico de listado reutilizable para futuras entidades

## Análisis del Código Existente

### Backend - Endpoints Disponibles
- **GET** `/api/companies/{id}` - Obtener company por ID (ya implementado)
- **PUT** `/api/companies/{id}` - Actualizar company (ya implementado)
- **GET** `/api/companies` - Obtener listado de companies con paginación (ya implementado)

### Frontend - Componentes Existentes
- `company-register.component.html` - Estructura completa del formulario (444 líneas)
- `company-register.component.ts` - Lógica del formulario con validaciones
- `accordion-section.component` - Componente reutilizable para secciones colapsables
- `sidebar.component.html` - Navegación con item "Empresa" sin enlace

## Archivos a Modificar/Crear

### 1. Frontend - Modelos y Servicios

#### `src/frontend/src/app/company/models/company-register.models.ts`
**Modificar:** Agregar interfaces para edición
```typescript
// Nuevas interfaces para edición
export interface UpdateCompanyCommand {
  id: string;
  name: string;
  taxId: string;
  addresses: UpdateCompanyAddressDto[];
  emails: UpdateCompanyEmailDto[];
  phones: UpdateCompanyPhoneDto[];
  socialMedias: UpdateCompanySocialMediaDto[];
  employees: UpdateCompanyEmployeeDto[];
}

export interface UpdateCompanyAddressDto {
  id?: string;
  addressTypeId: string;
  address: string;
  isPrimary: boolean;
}

// ... (resto de interfaces UpdateCompany*)
```

#### `src/frontend/src/app/company/services/CompanyService.ts`
**Modificar:** Agregar métodos para edición y listado
```typescript
// Nuevos métodos
getCompanyById(id: string): Observable<GetCompanyResult>
updateCompany(id: string, command: UpdateCompanyCommand): Observable<UpdateCompanyResult>
getCompanies(page: number, pageSize: number, searchTerm?: string): Observable<GetCompaniesResult>
```

### 2. Frontend - Componente de Edición

#### `src/frontend/src/app/company/edit/company-edit.component.ts`
**Crear:** Componente de edición que extienda la funcionalidad de registro
- Reutilizar toda la lógica de `company-register.component.ts`
- Agregar método `loadCompanyData(id: string)` para cargar datos existentes
- Modificar `onSubmit()` para llamar a `updateCompany()` en lugar de `registerCompany()`
- Agregar manejo de IDs en formularios para elementos existentes

#### `src/frontend/src/app/company/edit/company-edit.component.html`
**Crear:** Copiar exactamente `company-register.component.html` y modificar:
- Cambiar título de "Registro de Empresa" a "Edición de Empresa"
- Cambiar texto del botón de "Registrando..." a "Actualizando..."

#### `src/frontend/src/app/company/edit/company-edit.component.scss`
**Crear:** Copiar exactamente `company-register.component.scss`

### 3. Frontend - Componente de Listado Genérico

#### `src/frontend/src/app/shared/components/data-table/data-table.component.ts`
**Crear:** Componente genérico para listados con AdminLTE
```typescript
export interface DataTableColumn {
  key: string;
  title: string;
  sortable?: boolean;
  render?: (value: any, row: any) => string;
}

export interface DataTableAction {
  label: string;
  icon: string;
  class: string;
  action: (row: any) => void;
}

@Component({
  selector: 'app-data-table',
  template: `
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">{{ title }}</h3>
        <div class="card-tools">
          <button class="btn btn-primary" (click)="onAdd.emit()">
            <i class="fas fa-plus"></i> {{ addButtonText }}
          </button>
        </div>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th *ngFor="let col of columns">{{ col.title }}</th>
                <th *ngIf="actions.length > 0">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of data">
                <td *ngFor="let col of columns">
                  {{ col.render ? col.render(row[col.key], row) : row[col.key] }}
                </td>
                <td *ngIf="actions.length > 0">
                  <button *ngFor="let action of actions" 
                          class="btn btn-sm" 
                          [class]="action.class"
                          (click)="action.action(row)">
                    <i [class]="action.icon"></i> {{ action.label }}
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `
})
```

#### `src/frontend/src/app/shared/components/data-table/data-table.component.scss`
**Crear:** Estilos AdminLTE para la tabla

### 4. Frontend - Listado de Companies

#### `src/frontend/src/app/company/list/company-list.component.ts`
**Crear:** Componente que use el data-table genérico
```typescript
@Component({
  selector: 'app-company-list',
  template: `
    <app-data-table
      [title]="'Listado de Empresas'"
      [columns]="columns"
      [data]="companies()"
      [actions]="actions"
      [addButtonText]="'Nueva Empresa'"
      (onAdd)="navigateToRegister()">
    </app-data-table>
  `
})
```

#### `src/frontend/src/app/company/list/company-list.component.html`
**Crear:** Template simple que use el data-table

#### `src/frontend/src/app/company/list/company-list.component.scss`
**Crear:** Estilos específicos si es necesario

### 5. Frontend - Rutas y Navegación

#### `src/frontend/src/app/app.routes.ts`
**Modificar:** Agregar nuevas rutas
```typescript
// Agregar imports
import { CompanyEditComponent } from './company/edit/company-edit.component';
import { CompanyListComponent } from './company/list/company-list.component';

// Agregar rutas en children del MainLayoutComponent
{ path: 'company/list', component: CompanyListComponent, canActivate: [authGuard] },
{ path: 'company/edit/:id', component: CompanyEditComponent, canActivate: [authGuard] }
```

#### `src/frontend/src/app/admin-layout/sidebar/sidebar.component.html`
**Modificar:** Agregar enlace al listado de companies
```html
<!-- Cambiar línea 33 -->
<sidebar-child-item TextValue="Empresa" Icon="fa-users-cog" [routerLink]="['/company/list']"></sidebar-child-item>
```

### 6. Backend - Tests Unitarios

#### `src/tests/UnitTests/Companies/CompanyEditTests.cs`
**Crear:** Tests para funcionalidad de edición
- Test de carga de datos existentes
- Test de validación de formulario
- Test de actualización exitosa
- Test de manejo de errores

#### `src/tests/UnitTests/Companies/CompanyListTests.cs`
**Crear:** Tests para funcionalidad de listado
- Test de paginación
- Test de búsqueda
- Test de ordenamiento

## Algoritmo de Implementación

### Fase 1: Preparación de Modelos y Servicios
1. Extender `company-register.models.ts` con interfaces de edición
2. Extender `CompanyService.ts` con métodos de edición y listado
3. Crear tests unitarios para los nuevos métodos del servicio

### Fase 2: Componente de Edición
1. Crear `company-edit.component.ts` basado en `company-register.component.ts`
2. Implementar método `loadCompanyData()` que llame a `getCompanyById()`
3. Modificar `onSubmit()` para usar `updateCompany()`
4. Crear templates HTML y SCSS copiando de company-register
5. Agregar manejo de parámetros de ruta para obtener el ID

### Fase 3: Componente de Listado Genérico
1. Crear `data-table.component.ts` con configuración flexible
2. Implementar estilos AdminLTE para la tabla
3. Agregar funcionalidades de paginación y búsqueda
4. Crear tests unitarios para el componente genérico

### Fase 4: Listado de Companies
1. Crear `company-list.component.ts` que use el data-table genérico
2. Configurar columnas y acciones específicas para companies
3. Implementar navegación al formulario de edición
4. Agregar funcionalidad de búsqueda y filtrado

### Fase 5: Integración y Navegación
1. Agregar rutas en `app.routes.ts`
2. Modificar sidebar para incluir enlace al listado
3. Implementar navegación entre listado y edición
4. Agregar breadcrumbs si es necesario

### Fase 6: Tests y Validación
1. Crear tests unitarios para todos los componentes nuevos
2. Crear tests de integración para el flujo completo
3. Validar que la reutilización de código funcione correctamente
4. Verificar que los estilos AdminLTE se apliquen correctamente

## Consideraciones Técnicas

### Reutilización de Código
- El componente de edición debe reutilizar el 90% del código de `company-register.component.ts`
- Usar herencia o composición para evitar duplicación
- El componente `accordion-section` ya es reutilizable y se mantiene igual

### Estilos AdminLTE
- Usar clases estándar de AdminLTE: `card`, `table`, `btn`, `form-control`
- Mantener consistencia con el diseño existente
- El componente `data-table` debe ser completamente responsive

### Manejo de Estados
- Usar signals de Angular para el estado reactivo
- Implementar loading states para operaciones asíncronas
- Manejar errores de manera consistente con el resto de la aplicación

### Validaciones
- Reutilizar todas las validaciones existentes de `company-register.component.ts`
- Agregar validaciones específicas para edición (ej: verificar que el ID existe)
- Mantener la misma experiencia de usuario

## Dependencias
- No se requieren nuevas dependencias externas
- Reutilizar todos los servicios existentes: `AddressTypeService`, `EmailTypeService`, etc.
- Mantener compatibilidad con la estructura de datos existente del backend

## Criterios de Éxito
1. El formulario de edición tiene exactamente la misma estructura que el de registro
2. El listado muestra companies con paginación y búsqueda
3. La navegación desde el sidebar funciona correctamente
4. El componente `data-table` es reutilizable para otras entidades
5. Todos los tests unitarios pasan
6. Los estilos AdminLTE se aplican correctamente
7. No hay duplicación de código entre registro y edición
