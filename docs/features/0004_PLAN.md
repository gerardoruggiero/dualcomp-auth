# Plan Técnico: Arquitectura Frontend Angular - Sistema de Autenticación y Gestión

## Contexto

Implementar la arquitectura inicial de un proyecto Angular frontend que consuma las APIs del backend .NET existente. El sistema debe incluir autenticación (login/logout), gestión completa de empresas (CRUD) y gestión de empleados (CRUD), siguiendo las mejores prácticas de Angular y arquitectura modular.

---

## Resumen de la Solución

- **Arquitectura modular** con separación clara de responsabilidades por dominio
- **Gestión de estado** con Angular Signals para simplicidad y performance
- **Autenticación segura** con JWT, guards y interceptors automáticos
- **UI moderna** con Angular Material y Tailwind CSS
- **Testing completo** con Jest y Angular Testing Library
- **Configuración responsive** optimizada para desktop, tablet y móvil

---

## Estructura de la Solución

### Fase 1: Configuración Base del Proyecto

#### Archivos de configuración a crear:
- `package.json` - Dependencias del proyecto Angular
- `angular.json` - Configuración del workspace Angular
- `tsconfig.json` - Configuración TypeScript
- `tailwind.config.js` - Configuración Tailwind CSS
- `jest.config.js` - Configuración Jest para testing
- `.eslintrc.json` - Configuración ESLint
- `.prettierrc` - Configuración Prettier
- `src/environments/` - Configuraciones por ambiente (dev, staging, prod)

#### Estructura de directorios:
```
src/
├── app/
│   ├── core/                    # Servicios singleton y configuración
│   │   ├── services/           # Servicios base (auth, http, etc.)
│   │   ├── guards/             # Guards de autenticación y autorización
│   │   ├── interceptors/       # HTTP interceptors
│   │   ├── models/             # Interfaces y tipos base
│   │   └── constants/          # Constantes de la aplicación
│   ├── shared/                 # Componentes y servicios reutilizables
│   │   ├── components/         # Componentes UI reutilizables
│   │   ├── pipes/              # Pipes personalizados
│   │   ├── directives/         # Directivas personalizadas
│   │   ├── services/           # Servicios compartidos
│   │   └── models/             # Interfaces compartidas
│   ├── features/               # Módulos de funcionalidades
│   │   ├── auth/               # Módulo de autenticación
│   │   ├── companies/          # Módulo de empresas
│   │   └── employees/          # Módulo de empleados
│   ├── layout/                 # Componentes de layout
│   │   ├── header/             # Header de la aplicación
│   │   ├── sidebar/            # Sidebar de navegación
│   │   └── footer/             # Footer de la aplicación
│   └── app.component.*         # Componente raíz
├── assets/                     # Recursos estáticos
├── styles/                     # Estilos globales
└── environments/               # Configuraciones por ambiente
```

### Fase 2: Módulo Core - Servicios Base

#### Archivos a crear en `src/app/core/`:

**Servicios:**
- `src/app/core/services/auth.service.ts` - Gestión de autenticación y tokens
- `src/app/core/services/http.service.ts` - Cliente HTTP base con interceptors
- `src/app/core/services/storage.service.ts` - Gestión de localStorage/sessionStorage
- `src/app/core/services/notification.service.ts` - Servicio de notificaciones

**Guards:**
- `src/app/core/guards/auth.guard.ts` - Protección de rutas autenticadas
- `src/app/core/guards/guest.guard.ts` - Protección de rutas para usuarios no autenticados

**Interceptors:**
- `src/app/core/interceptors/auth.interceptor.ts` - Inyección automática de tokens
- `src/app/core/interceptors/error.interceptor.ts` - Manejo centralizado de errores
- `src/app/core/interceptors/loading.interceptor.ts` - Indicador de carga global

**Modelos:**
- `src/app/core/models/user.model.ts` - Modelo de usuario
- `src/app/core/models/auth.model.ts` - Modelos de autenticación
- `src/app/core/models/api-response.model.ts` - Modelo de respuesta de API

**Constantes:**
- `src/app/core/constants/api.constants.ts` - URLs y endpoints de API
- `src/app/core/constants/app.constants.ts` - Constantes de la aplicación

### Fase 3: Módulo Shared - Componentes Reutilizables

#### Archivos a crear en `src/app/shared/`:

**Componentes:**
- `src/app/shared/components/loading-spinner/` - Componente de carga
- `src/app/shared/components/error-message/` - Componente de mensajes de error
- `src/app/shared/components/confirm-dialog/` - Modal de confirmación
- `src/app/shared/components/data-table/` - Tabla de datos reutilizable
- `src/app/shared/components/search-input/` - Input de búsqueda
- `src/app/shared/components/pagination/` - Componente de paginación

**Pipes:**
- `src/app/shared/pipes/date-format.pipe.ts` - Formateo de fechas
- `src/app/shared/pipes/currency-format.pipe.ts` - Formateo de moneda
- `src/app/shared/pipes/phone-format.pipe.ts` - Formateo de teléfonos

**Directivas:**
- `src/app/shared/directives/click-outside.directive.ts` - Detectar clics fuera del elemento
- `src/app/shared/directives/auto-focus.directive.ts` - Auto-focus en elementos

**Servicios:**
- `src/app/shared/services/validation.service.ts` - Validaciones comunes
- `src/app/shared/services/format.service.ts` - Servicios de formateo

### Fase 4: Módulo Auth - Autenticación

#### Archivos a crear en `src/app/features/auth/`:

**Componentes:**
- `src/app/features/auth/login/login.component.ts` - Componente de login
- `src/app/features/auth/logout/logout.component.ts` - Componente de logout
- `src/app/features/auth/change-password/change-password.component.ts` - Cambio de contraseña

**Servicios:**
- `src/app/features/auth/services/auth-api.service.ts` - Servicio de API de autenticación

**Modelos:**
- `src/app/features/auth/models/login-request.model.ts` - Modelo de request de login
- `src/app/features/auth/models/auth-response.model.ts` - Modelo de respuesta de auth

**Routing:**
- `src/app/features/auth/auth-routing.module.ts` - Rutas del módulo auth

### Fase 5: Módulo Companies - Gestión de Empresas

#### Archivos a crear en `src/app/features/companies/`:

**Componentes:**
- `src/app/features/companies/company-list/company-list.component.ts` - Listado de empresas
- `src/app/features/companies/company-detail/company-detail.component.ts` - Detalle de empresa
- `src/app/features/companies/company-form/company-form.component.ts` - Formulario de empresa
- `src/app/features/companies/company-search/company-search.component.ts` - Búsqueda de empresas

**Servicios:**
- `src/app/features/companies/services/company-api.service.ts` - Servicio de API de empresas
- `src/app/features/companies/services/company-state.service.ts` - Gestión de estado con Signals

**Modelos:**
- `src/app/features/companies/models/company.model.ts` - Modelo de empresa
- `src/app/features/companies/models/company-request.model.ts` - Modelos de request

**Routing:**
- `src/app/features/companies/companies-routing.module.ts` - Rutas del módulo companies

### Fase 6: Módulo Employees - Gestión de Empleados

#### Archivos a crear en `src/app/features/employees/`:

**Componentes:**
- `src/app/features/employees/employee-list/employee-list.component.ts` - Listado de empleados
- `src/app/features/employees/employee-detail/employee-detail.component.ts` - Detalle de empleado
- `src/app/features/employees/employee-form/employee-form.component.ts` - Formulario de empleado
- `src/app/features/employees/employee-search/employee-search.component.ts` - Búsqueda de empleados

**Servicios:**
- `src/app/features/employees/services/employee-api.service.ts` - Servicio de API de empleados
- `src/app/features/employees/services/employee-state.service.ts` - Gestión de estado con Signals

**Modelos:**
- `src/app/features/employees/models/employee.model.ts` - Modelo de empleado
- `src/app/features/employees/models/employee-request.model.ts` - Modelos de request

**Routing:**
- `src/app/features/employees/employees-routing.module.ts` - Rutas del módulo employees

### Fase 7: Layout y Navegación

#### Archivos a crear en `src/app/layout/`:

**Componentes:**
- `src/app/layout/header/header.component.ts` - Header principal
- `src/app/layout/sidebar/sidebar.component.ts` - Sidebar de navegación
- `src/app/layout/footer/footer.component.ts` - Footer
- `src/app/layout/main-layout/main-layout.component.ts` - Layout principal

**Servicios:**
- `src/app/layout/services/layout.service.ts` - Gestión del estado del layout

### Fase 8: Configuración de Testing

#### Archivos a crear:
- `src/app/core/services/auth.service.spec.ts` - Tests del servicio de auth
- `src/app/features/auth/login/login.component.spec.ts` - Tests del componente login
- `src/app/features/companies/company-list/company-list.component.spec.ts` - Tests del listado
- `src/app/shared/components/data-table/data-table.component.spec.ts` - Tests de componentes shared

#### Configuración de testing:
- `jest.config.js` - Configuración Jest
- `src/setup-jest.ts` - Setup de Jest para Angular
- `src/test-utils/` - Utilidades para testing

---

## Algoritmos y Flujos Principales

### 1. Flujo de Autenticación
1. Usuario ingresa credenciales en login
2. AuthService envía request a `/api/auth/login`
3. Backend valida credenciales y retorna JWT + refresh token
4. Tokens se almacenan en localStorage
5. AuthInterceptor inyecta automáticamente access token en requests
6. Refresh token se renueva automáticamente antes del vencimiento

### 2. Flujo de Gestión de Estado (Signals)
1. Cada módulo tiene su propio servicio de estado
2. Signals mantienen el estado reactivo de cada entidad
3. Componentes se suscriben a signals para actualizaciones automáticas
4. Servicios de API actualizan signals después de operaciones CRUD

### 3. Flujo de Navegación y Guards
1. AuthGuard verifica autenticación antes de acceder a rutas protegidas
2. GuestGuard redirige usuarios autenticados desde rutas públicas
3. Layout service gestiona el estado de sidebar y navegación
4. Router outlet renderiza componentes según la ruta activa

---

## Consideraciones Técnicas

### Performance
- **Lazy Loading**: Módulos se cargan bajo demanda
- **OnPush Change Detection**: Optimización de detección de cambios
- **TrackBy Functions**: Optimización de listas con ngFor
- **Bundle Optimization**: Configuración de build para producción

### Seguridad
- **JWT Storage**: Tokens almacenados de forma segura
- **XSS Protection**: Sanitización de inputs
- **CSRF Protection**: Headers de seguridad en requests
- **Route Protection**: Guards para rutas sensibles

### Responsive Design
- **Mobile First**: Diseño optimizado para móviles
- **Breakpoints**: Configuración Tailwind para diferentes dispositivos
- **Touch Friendly**: Interfaces optimizadas para touch
- **Progressive Enhancement**: Funcionalidad adaptada por dispositivo

### Testing Strategy
- **Unit Tests**: Cobertura de servicios y componentes
- **Integration Tests**: Tests de flujos completos
- **E2E Tests**: Tests de usuario final (opcional)
- **Mock Services**: Simulación de APIs para testing

---

## Configuración de Ambientes

### Development
- API Base URL: `http://localhost:5000`
- Debug mode habilitado
- Source maps activos
- Hot reload configurado

### Staging
- API Base URL: `https://staging-api.dualcomp.com`
- Optimizaciones de build
- Logging reducido

### Production
- API Base URL: `https://api.dualcomp.com`
- Build optimizado
- Logging mínimo
- PWA habilitado (opcional)

---

## Dependencias Principales

### Core Angular
- `@angular/core`: ^20.0.0
- `@angular/common`: ^20.0.0
- `@angular/router`: ^20.0.0
- `@angular/forms`: ^20.0.0

### UI y Styling
- `@angular/material`: ^20.0.0
- `tailwindcss`: ^3.4.0
- `@angular/cdk`: ^20.0.0

### HTTP y Estado
- `@angular/common/http`: ^17.0.0
- `rxjs`: ^7.8.0

### Testing
- `jest`: ^29.7.0
- `@angular/testing`: ^20.0.0
- `@testing-library/angular`: ^16.0.0

### Herramientas de Desarrollo
- `eslint`: ^8.55.0
- `prettier`: ^3.1.0
- `typescript`: ^5.3.0
